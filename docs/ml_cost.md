# AWS PoC概算費用算出レポート

本ドキュメントは、車両API連携およびSageMakerを用いた個別化モデル（100ユーザー）の検証PoCにおけるAWS利用費用の概算見積もりである。

## 1. 算出の前提条件
* **為替レート:** 1ドル = 150円
* **リージョン:** アジアパシフィック (東京)
* **対象規模:** 100ユーザー（＝100モデル）
* **検証データ:** 過去1年分のデータを用いたバックテスト（1モデルあたり12ヶ月分検証）
* **採用アーキテクチャ:**
    * 推論: SageMaker Multi-Model Endpoint (MME) によるリソース集約
    * 学習: SageMaker Pipelines (Processing + Training Jobs)
    * 通知: API Gateway + Lambda + SES

---

## 2. 公式価格リファレンス (参照URL)
詳細な単価は以下の公式ページに基づく（全て東京リージョンの「オンデマンド」価格を参照）。

* **[Amazon SageMaker 料金表](https://aws.amazon.com/jp/sagemaker/pricing/)**
    * 参照タブ: 「推論(Real-time)」「処理(Processing)」「トレーニング(Training)」「Studio」
* **[Amazon S3 料金表](https://aws.amazon.com/jp/s3/pricing/)** (Standard ストレージ)
* **[Amazon CloudWatch 料金表](https://aws.amazon.com/jp/cloudwatch/pricing/)** (ログ取込・保存)
* **[Amazon ECR 料金表](https://aws.amazon.com/jp/ecr/pricing/)** (コンテナ保存)
* **[Amazon SES 料金表](https://aws.amazon.com/jp/ses/pricing/)** (メール送信)

---

## 3. コスト変動変数（コストドライバー）
本見積もりにおいて、金額を左右する主要な変数は以下の通りである。

| 変数名 | 影響するサービス | コストへの影響内容 |
| :--- | :--- | :--- |
| **インスタンス稼働時間** | SageMaker Studio<br>SageMaker Inference | サーバーを起動している「時間」に対して課金される。使わない夜間や休日に停止することで節約可能。 |
| **学習・処理時間** | Processing / Training Jobs | 「1回の処理にかかる分/秒」×「実行回数」で課金される。スクリプトの効率化で短縮可能。 |
| **ログ出力頻度** | CloudWatch Logs | `print()` 出力等が多すぎると、ログ取込量(GB)が増え、想定外の高額課金になる場合がある。 |
| **バックテスト回数** | Training Jobs | 1モデルに対して「過去何回分（何ヶ月分）ずらして検証するか」でジョブ総数が決まる。 |

---

## 4. フェーズ別概算コスト詳細

PoCを3つのフェーズに分解し、それぞれの単価を示す。

### フェーズA：データ分析・開発環境 (日次コスト)
コード記述、データ確認を行うフェーズ。
* **利用構成:** 開発者1名 (1日8時間稼働想定)
* **比較:** ローカル開発時は計算リソース費がかからない。

| 項目 | パターン1 (Full AWS) | パターン2 (Local併用) | 算出根拠 (AWS利用時) |
| :--- | :--- | :--- | :--- |
| **開発インスタンス** | **約 120円 / 日** | **0円 / 日** | `ml.t3.medium` ($0.05/h) × 8h × 余裕率 |
| **ストレージ(S3)** | **約 10円 / 日** | **約 10円 / 日** | 50GB保管 ($0.023/GB/月 ÷ 30日) |
| **計 (日額目安)** | **約 130円** | **約 10円** | |

### フェーズB：パイプライン検証・学習 (一括コスト)
作成したスクリプトで、全100モデルのバックテスト計算を行うフェーズ。
**※この重い処理は、パターン1・2共通でAWSリソースを用いて実行する。**

* **ジョブ総数:** 100モデル × 12回 (バックテスト) ＝ **1,200ジョブ**
* **1回あたり:** 前処理5分 ＋ 学習5分 ＝ 計10分 (`ml.m5.large`)

| 項目 | 1ジョブあたり単価 | 1,200ジョブ実行時の総額 |
| :--- | :--- | :--- |
| **前処理 (Processing)** | 約 4円 | 4,800円 |
| **学習 (Training)** | 約 4円 | 4,800円 |
| **周辺費用 (ECR/Log)** | - | 約 550円 (コンテナ保管・ログ等) |
| **計 (総額目安)** | **約 8円** | **約 10,150円** |

### フェーズC：統合テスト・推論稼働 (日次コスト)
推論APIを常時起動し、アプリ連携とメール通知をテストする期間。

* **構成:** `ml.m5.xlarge` (Multi-Model Endpoint) × 1台 × 24時間稼働

| 項目 | 日次コスト | 備考 |
| :--- | :--- | :--- |
| **推論API (SageMaker)** | **約 980円 / 日** | $0.269/h × 24h × 150円。コストの大部分を占める。 |
| **メール通知 (SES)** | **約 1円 / 日** | 1日数百〜数千通程度なら誤差範囲。 |
| **API基盤 (Lambda/GW)** | **約 5円 / 日** | リクエスト量によるが安価。 |
| **計 (日額目安)** | **約 1,000円** | **テスト期間の日数分かかる** |

---

## 5. PoC総額シミュレーション (モデルケース)

一般的な検証スケジュールに当てはめた場合の総額試算。

**【スケジュール想定】**
1. **開発期間 (フェーズA):** 10日間 (平日2週間程度)
2. **学習実行 (フェーズB):** 全量1,200ジョブを一括実行
3. **結合テスト (フェーズC):** 5日間 (APIを上げっぱなしでアプリと結合)

**【見積もり総額】**

| 費目 | 計算式 | パターン1 (Full AWS) | パターン2 (Local併用) |
| :--- | :--- | :--- | :--- |
| **1. 開発環境費** | @130円 or @10円 × 10日 | 1,300円 | 100円 |
| **2. 学習・検証費** | 全量実施 (固定) | 10,150円 | 10,150円 |
| **3. 結合テスト費** | @1,000円 × 5日 | 5,000円 | 5,000円 |
| **合計 (税抜)** | | **約 16,450円** | **約 15,250円** |

### 結論と推奨
* 金額差は **約1,200円** 程度である。
* 環境差異によるトラブルシューティング工数（人件費）のリスクを考慮すると、**「パターン1 (Full AWS)」** の採用を推奨する。
* いずれのパターンでも、**月額 20,000円 〜 30,000円** の予算を確保すれば、余裕を持った検証が可能である。